# Flyweightパターン

## 説明

- ゲームなどのメモリ効率が求められる場面において、ある一つのオブジェクトを外因的状態(頻繁に変更される・バリエーションが豊富な部分)と内因的状態(あまり変更されない部分)に分け、外因的状態が内因的状態を参照として保持することによって内因的状態の不必要な作成・複製を防ぐパターン．
- Rustにおいては変更できる参照を複数が保持することはできないため，`Rc<RefCell<ファクトリ(HashMap)>>`のように内部可変性を用いることになる．
- ゲーム開発ではECS(Entity Component System)というパラダイムがよく用いられており，ECSは以下の特徴がある．
  - データオブジェクト(Rustの場合は普通の構造体や列挙体)(ECSではコンポーネントと呼ばれる)をストレージが保有・一元的に管理する．
  - コンポーネントの取得はエンティティと呼ばれるIDかストレージに対するクエリによって行う．
  - データはメモリに連続して配置され，メモリサイズやキャッシュが効率的になる
  - ふるまいはシステムと呼ばれる関数が担当し、コンポーネントをバッチ処理して並列化・最適化を行うことができる．
- このECSを用いれば、Rustでは再現しにくいアーキテクチャを実現できる．Flyweightパターンも，内因的状態をエンティティとして外因的状態のコンポーネントが保有することで実現できる．
- ECSを用いてOOPのアーキテクチャを実現することは困難だが，内因的状態の共有やメモリの効率化は実現できる．
