# Flyweightパターン

## 説明

- ゲームなどのメモリ効率が求められる場面において、ある一つのオブジェクトを外因的状態(頻繁に変更される・バリエーションが豊富な部分)と内因的状態(あまり変更されない部分)に分け、外因的状態が内因的状態を参照として保持することによって内因的状態の不必要な作成・複製を防ぐパターン．
- Rustにおいては変更できる参照を複数が保持することはできないため，以下の二つの方法が考えられる．今回は二つ目を用いた．
  - `Rc<RefCell<HashMap>>`のように内部可変性を用いて内因的状態を保存し、外因的状態は内因的状態をIDとして保持する方法．この方法ではFlyweightの型の種類の数だけ管理するHashMapやグローバル変数が増えてしまう．
  - 内因的状態をイミュータブルとし、リファレンスカウントによって所有権の複製を行う方法．内因的状態を変更するためには新しく作成し直す必要がある．
- ゲーム開発ではECS(Entity Component System)というパラダイムがよく用いられている．ECSはデータ構造をストレージに保存・IDによる一括管理によってRustで再現しにくい複雑なデータ構造も再現できる．
- `ecs`ディレクトリではECSを用いて実装している．
