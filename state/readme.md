# Stateパターン

```shell
cargo run
```

## 説明

状態遷移を型によって表現する．Stateパターン以外も含めるとbinにもあるように以下の実装が考えられる．

- データは持たず状態のみを表す型をトレイトオブジェクト(Box)として保持し，状態遷移をそのトレイトオブジェクトに委譲する
    Stateパターンのオーソドックスな実装．ヒープに載せる型がデータを持たないため，コストもそれほど気にしなくてすむ．状態遷移や状態に依存する処理を厳密にチェックしたいとなると`Result`による動的チェックとなる(状態遷移についてはチェックせず，遷移を無視することも多い)．
- 状態を別々の型として実装し，データの所有権を`self`で渡しながら型を変換(状態遷移)させていく
    rust patternにあったトレードオフの実装．状態遷移のためのメソッドをコンパイル時にチェックできるため、安全に状態遷移が行える．しかし状態を別々の型として定義しているためフィールドとして保持することができず，ローカル変数として利用するしかない．
- 上の実装の派生版としてファントムタイプを利用したバージョン
    見た目では少し分かりやすいが，同じ問題を抱えている．
- 上の実装の派生版として変換用のトレイトを用いたバージョン
    `From`トレイトのように状態遷移用のトレイトを定義・各状態に実装していく．上二つと同じ問題を抱えている．
- 状態を別々の型として実装し、`Box::downcast`を用いてトレイトオブジェクトから具象型に変換する
    状態遷移をコンパイル時にチェックできるが，現在の状態がなんであるかをdowncastを用いて動的チェックする必要がある．
- 状態を列挙体のバリアントとして定義し，状態遷移を各バリアントで場合分けて行う
    状態が少数なら最も自然な方法．トレイトオブジェクトを利用した方法と同じで動的チェックとなる．状態遷移を委譲できないため，各状態毎に遷移のロジックを分離することができず、状態が増えるごとに列挙体の実装が大きくなってしまう．

今回は一番目を用いた．
